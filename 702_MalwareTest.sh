#!/bin/sh

warn () {
    echo "$0:" "$@" >&2
}
die () {
    rc=$1
    shift
    warn "$@"
    exit $rc
}

if [ -z ${ATK_IP+x} ]; then die "ATK_IP is unset, use export ATK_IP=10.10.10.10";  fi
if [ -z ${ATK_PORT+x} ]; then die "ATK_PORT is unset, use export ATK_PORT=443";  fi
if [ -z ${PROJECT+x} ]; then die "PROJECT is unset, use export PROJECT=[PROJECT NAME]";  fi
if [ -z ${PROJECTNUM+x} ]; then die "PROJECTNUM is unset, use export PROJECTNUM=[PROJECT NUMBER]";  fi

./700_MeterpreterGenerator.pl $ATK_IP $ATK_PORT $PROJECT $PROJECTNUM
./705_MetasploitListeners.py $ATK_IP $ATK_PORT $PROJECT $PROJECTNUM           
cp /opt/eicar/* /opt/malwaredefense/current/
zip -r /opt/malwaredefense/current/999-$PROJECT-$PROJECTNUM-Malware-CurrentBattery.zip /opt/malwaredefense/current/*
