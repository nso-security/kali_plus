#!/bin/sh

warn () {
    echo "$0:" "$@" >&2
}
die () {
    rc=$1
    shift
    warn "$@"
    exit $rc
}

if [ -z ${ATK_IP+x} ]; then die 100 "ATK_IP is unset, use export ATK_IP=10.10.10.10";  fi
if [ -z ${ATK_PORT+x} ]; then die 101 "ATK_PORT is unset, use export ATK_PORT=443";  fi
if [ -z ${PROJECT+x} ]; then die 102 "PROJECT is unset, use export PROJECT=[PROJECT NAME]";  fi
if [ -z ${PROJECTNUM+x} ]; then die 103 "PROJECTNUM is unset, use export PROJECTNUM=[PROJECT NUMBER]";  fi

./700_MeterpreterGenerator.pl $ATK_IP $ATK_PORT $PROJECT $PROJECTNUM
./705_MetasploitListeners.py $ATK_IP $ATK_PORT $PROJECT $PROJECTNUM
           
cp /opt/eicar/eicar.com /opt/malwaredefense/current/0001-eicar.com
cp /opt/eicar/eicar.com.txt /opt/malwaredefense/current/0002-eicar.com.txt
cp /opt/eicar/eicar.com.txt /opt/malwaredefense/current/0003-eicar.com.jpg
cp /opt/eicar/eicar_com.zip /opt/malwaredefense/current/0004-eicar.zip
cp /opt/eicar/eicarcom2.zip /opt/malwaredefense/current/0005-eicar2.zip

zip -r /opt/malwaredefense/current/999-$PROJECT-$PROJECTNUM-Malware-CurrentBattery.zip /opt/malwaredefense/current/*
